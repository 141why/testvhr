<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../css/xadmin.css">
    <script src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/xadmin.js"></script>
    <script type="text/javascript" src="../data/selectData.js"></script>
    <style>
        .layui-form-item .layui-input-inline{
            width: 110px;
        }
        .layui-input-inline input{
            width: 110px;
        }
        .layui-form-label{
            padding-left: 0;
        }
    </style>
</head>

<body>
<div class="layui-fluid ">
    <div class="layui-row layui-card">
        <div class="site-text site-block">
            <div class="layui-form  layui-col-space3"  lay-filter="example">
                <div class="layui-form-item"></div>
                <div class="layui-form-item">
                    <label for="name" class="layui-form-label ">
                        <span class="x-red">*</span>雇员姓名</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" id="name" name="name" placeholder="请输入雇员姓名" required="" lay-verify="required"
                               autocomplete="off" class="layui-input">
                        <input type="hidden" name="id" >
                    </div>
                    <label class="layui-form-label">性别</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="radio" name="gender" value="男" title="男" checked="">
                        <div class="layui-unselect layui-form-radio">
                            <i class="layui-anim layui-icon"></i><div>男</div></div>
                        <input type="radio" name="gender" value="女" title="女" checked="">
                        <div class="layui-unselect layui-form-radio layui-form-radioed">
                            <i class="layui-anim layui-icon"></i><div>女</div></div>
                    </div>

                    <label for="birthday" class="layui-form-label">
                        <span class="x-red">*</span>出生日期</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input class="layui-input time" name="birthday" id="birthday" lay-verify="required|date" >
                    </div>

                    <label for="politic" class="layui-form-label">
                        <span class="x-red">*</span>政治面貌</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <select id="politic" name="politicid">
                            <option value="0">请选择</option>
                        </select>
                    </div>
                </div>


                <div class="layui-form-item">
                    <label for="nation" class="layui-form-label">
                        <span class="x-red">*</span>民族</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <select id="nation" name="nationid" lay-verify="required">
                            <option value="0">请选择</option>
                        </select>
                    </div>

                    <label for="nativeplace" class="layui-form-label">
                        <span class="x-red">*</span>籍贯</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="nativeplace" id="nativeplace" placeholder="" required="" lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>

                    <label for="address" class="layui-form-label">
                        <span class="x-red">*</span>联系地址</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="address" id="address" placeholder="" required="" lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>

                    <label for="email" class="layui-form-label">
                        <span class="x-red">*</span>电子邮箱</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="email" id="email" required="" lay-verify="required | email"
                               autocomplete="off" class="layui-input">
                    </div>

                </div>

                <div class="layui-form-item">
                    <label for="posid" class="layui-form-label">
                        <span class="x-red">*</span>职位</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <select id="posid" name="posid">
                            <option value="0">请选择</option>
                        </select>
                    </div>

                    <label for="joblevel" class="layui-form-label">
                        <span class="x-red">*</span>职称</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <select id="joblevel" name="joblevelid">
                            <option value="0">请选择</option>
                        </select>
                    </div>

                    <label for="dept" class="layui-form-label">
                        <span class="x-red">*</span>所属部门</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <select id="dept" name="departmentid">
                            <option value="0">请选择</option>
                        </select>
                    </div>

                    <label for="phone" class="layui-form-label">
                        <span class="x-red">*</span>电话号码</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="phone" id="phone" required="" lay-verify="required | phone"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="tiptopdegree" class="layui-form-label">
                        <span class="x-red">*</span>学历</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="tiptopdegree" id="tiptopdegree" required="" lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>

                    <label for="school" class="layui-form-label">
                        <span class="x-red">*</span>毕业院校</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="school" id="school" required="" lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>

                    <label for="specialty" class="layui-form-label">
                        <span class="x-red">*</span>专业</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="text" name="specialty" id="specialty" required="" lay-verify="required"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="begindate" class="layui-form-label">
                        <span class="x-red">*</span>入职日期</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input class="layui-input time" name="begindate" id="begindate" lay-verify="required|date">
                    </div>

                    <label for="conversiontime" class="layui-form-label">
                        <span class="x-red">*</span>转正日期</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input class="layui-input time" name="conversiontime" id="conversiontime" lay-verify="required|date">
                    </div>

                    <label for="begincontract" class="layui-form-label">
                        <span class="x-red">*</span>合同起始日期</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input class="layui-input time" name="begincontract" id="begincontract" lay-verify="required|date">
                    </div>

                    <label for="endcontract" class="layui-form-label">
                        <span class="x-red">*</span>合同终止日期</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input class="layui-input time" name="endcontract" id="endcontract" lay-verify="required|date">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label for="idcard" class="layui-form-label">
                        <span class="x-red">*</span>身份证号码</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input class="layui-input" name="idcard" id="idcard" lay-verify="identity|required">
                    </div>

                    <label class="layui-form-label">
                        <span class="x-red">*</span>聘用形式</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="radio" name="engageform" value="1" title="劳务合同">
                        <div class="layui-unselect layui-form-radio">
                            <i class="layui-anim layui-icon"></i><div>劳务合同</div>
                        </div>
                        <input type="radio" name="engageform" value="2"  checked="" title="劳动合同">
                        <div class="layui-unselect layui-form-radio layui-form-radioed">
                            <i class="layui-anim layui-icon"></i><div>劳动合同</div>
                        </div>
                    </div>


                    <label class="layui-form-label">
                        <span class="x-red">*</span>婚姻状况</label>
                    <div class="layui-input-inline layui-show-xs-block">
                        <input type="radio" name="wedlock" value="未婚" title="未婚" checked="checked">
                        <div class="layui-unselect layui-form-radio">
                            <i class="layui-anim layui-icon"></i><div>未婚</div></div>
                        <input type="radio" name="wedlock" value="已婚" title="已婚" >
                        <div class="layui-unselect layui-form-radio layui-form-radioed">
                            <i class="layui-anim layui-icon"></i><div>已婚</div></div>
                        <input type="radio" name="wedlock" value="离异" title="离异" >
                        <div class="layui-unselect layui-form-radio layui-form-radioed">
                            <i class="layui-anim layui-icon"></i><div>离异</div></div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="add">更新雇员信息</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>

    function getQueryVaribale(varibale){
        let query=window.location.search.substring(1)
        let vars=query.split("&")
        for(let i=0;i<vars.length;i++){
            let pair=vars[i].split("=")
            if(pair[0]==varibale){
                return pair[1]
            }
        }
        return false
    }
    let id=getQueryVaribale("id")
    //获取下拉列表数据
    eachSelectData(['dept','posid','politic','nation','joblevel' ],true)
    //日期函数
    layui.use(['laydate', 'form'], function () {
        lay('.time').each(function () {
            layui.laydate.render({
                elem: this,
                format: "yyyy-MM-dd"
            });
        })
    });

    layui.use(['form', 'layer'], function () {
        $ = layui.jquery;
        let form = layui.form,
            layer = layui.layer;

        $.getJSON('emp/id/'+id,function (result) {
            let emp=result.data
            //给表单赋值
            form.val("example", { //formTest 即 class="layui-form" 所在元素属性 lay-filter="" 对应的值
                "id":emp.id,
                "name":emp.name,
                "gender":emp.gender,
                "birthday":emp.birthday,
                "politicid":emp.politicid,
                "nationid":emp.nationid,
                "nativeplace":emp.nativeplace,
                "address":emp.address,
                "email":emp.email,
                "posid":emp.posid,
                "joblevelid":emp.joblevelid,
                "dept":emp.dept,
                "phone":emp.phone,
                "tiptopdegree":emp.tiptopdegree,
                "school":emp.school,
                "specialty":emp.specialty,
                "begindate":emp.begindate,
                "conversiontime":emp.conversiontime,
                "begincontract":emp.begincontract,
                "endcontract":emp.endcontract,
                "idcard":emp.idcard,
                "engageform":emp.engageform,
                "wedlock":emp.wedlock
            });
        })
        //监听提交
        form.on('submit(add)', function (data) {
            console.log(data)
            let formData=JSON.stringify(data.field)
            $.ajax({
                type:"PUT",
                url:"./emp",
                data:formData,
                dataType:"json",
                contentType:"application/json;charset=utf-8",
                success:function (result) {
                    layer.alert(result.message, function (index) {
                        parent.layer.close(index)
                    })
                }, error(){
                    layer.alert(result.message, function (index) {
                        parent.layer.close(index)
                    })
                }
            })
        });
    });
</script>
</body>

</html>